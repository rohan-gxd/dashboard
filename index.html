<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artisteeka | Business OS</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts: Montserrat (Core UI) and Hind Siliguri (Bengali Support) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        // Priority: Hind Siliguri (for Bangla/general), then Montserrat (core UI), then system sans-serif.
                        sans: ['Montserrat', 'Hind Siliguri', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            black: '#000000',
                            lime: '#E0FF00',
                            white: '#FFFFFF',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Montserrat', 'Hind Siliguri', sans-serif;
            overflow-x: hidden;
        }

        /* Technical Background Grid */
        .bg-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        }

        /* Glassmorphism Effect */
        .glass-panel {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #E0FF00; }

        /* Inputs */
        .input-dark {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }
        .input-dark:focus {
            outline: none;
            border-color: #E0FF00;
            box-shadow: 0 0 15px rgba(224, 255, 0, 0.1);
        }
        
        /* Button */
        .btn-lime {
            background-color: #E0FF00;
            color: #000000;
            font-weight: 700;
            transition: all 0.2s;
        }
        .btn-lime:hover {
            background-color: #d1ee00;
            transform: translateY(-1px);
            box-shadow: 0 0 20px rgba(224, 255, 0, 0.4);
        }

        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        /* Invoice Paper for Print */
        .invoice-paper {
            background: white;
            color: black;
            min-height: 297mm;
            font-family: 'Montserrat', 'Hind Siliguri', sans-serif;
        }
    </style>
</head>
<body class="bg-grid h-screen flex flex-col font-sans">

    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-grid">
        <div class="glass-panel p-10 rounded-2xl w-full max-w-md text-center border border-white/10 relative overflow-hidden">
            <!-- Decorative Lime line -->
            <div class="absolute top-0 left-0 w-full h-1 bg-brand-lime shadow-[0_0_20px_#E0FF00]"></div>
            
            <h1 class="text-4xl font-black mb-2 tracking-tighter">ARTISTEEKA</h1>
            <p class="text-gray-400 text-sm mb-8 tracking-widest uppercase font-semibold">Management Console</p>
            
            <form onsubmit="handleLogin(event)" class="space-y-5 text-left">
                <div>
                    <label class="text-xs text-brand-lime font-bold uppercase ml-1 tracking-wider">Username</label>
                    <input type="text" id="username" class="input-dark w-full px-4 py-3 rounded-lg mt-1" placeholder="Enter username">
                </div>
                <div>
                    <label class="text-xs text-brand-lime font-bold uppercase ml-1 tracking-wider">Password</label>
                    <div class="relative mt-1">
                        <input type="password" id="password" class="input-dark w-full px-4 py-3 rounded-lg pr-12" placeholder="Enter password">
                        <button type="button" onclick="togglePasswordVisibility()" class="absolute right-0 top-0 h-full px-4 text-gray-400 hover:text-brand-lime transition-colors focus:outline-none">
                            <i class="fa-solid fa-eye" id="eye-icon"></i>
                        </button>
                    </div>
                </div>
                <p id="login-error" class="text-red-500 text-xs hidden text-center mt-2 font-bold uppercase tracking-wide">Access Denied. Check Credentials.</p>
                <button type="submit" class="btn-lime w-full py-3 rounded-lg mt-4 uppercase tracking-wider text-sm font-bold">Initialize System</button>
            </form>
        </div>
    </div>

    <!-- MAIN APP (Hidden initially) -->
    <div id="app-container" class="hidden flex-1 flex overflow-hidden">
        
        <!-- SIDEBAR -->
        <aside class="w-20 lg:w-64 glass-panel border-r-0 border-t-0 border-b-0 border-l-0 border-white/10 flex flex-col z-20 transition-all duration-300">
            <div class="h-20 flex items-center justify-center lg:justify-start lg:px-6 border-b border-white/10">
                <!-- Logo text only -->
                <span class="font-black text-xl tracking-tighter uppercase">ARTISTEEKA</span>
            </div>

            <nav class="flex-1 py-6 space-y-2 px-3">
                <button onclick="nav('dashboard')" id="btn-dashboard" class="nav-button w-full flex items-center p-3 rounded-lg text-brand-lime bg-white/10 border border-brand-lime/20">
                    <i class="fa-solid fa-grid-2 text-lg w-8"></i>
                    <span class="hidden lg:block font-medium">Dashboard</span>
                </button>
                <button onclick="nav('projects')" id="btn-projects" class="nav-button w-full flex items-center p-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-colors">
                    <i class="fa-solid fa-bars-progress text-lg w-8"></i>
                    <span class="hidden lg:block font-medium">Projects</span>
                </button>
                <button onclick="nav('clients')" id="btn-clients" class="nav-button w-full flex items-center p-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-colors">
                    <i class="fa-solid fa-users text-lg w-8"></i>
                    <span class="hidden lg:block font-medium">Clients</span>
                </button>
                <button onclick="nav('invoiceGen')" id="btn-invoiceGen" class="nav-button w-full flex items-center p-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-colors">
                    <i class="fa-solid fa-file-invoice-dollar text-lg w-8"></i>
                    <span class="hidden lg:block font-medium">Invoice Gen</span>
                </button>
                <!-- NEW Tab for Stored Invoices -->
                <button onclick="nav('invoices')" id="btn-invoices" class="nav-button w-full flex items-center p-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-colors">
                    <i class="fa-solid fa-file-lines text-lg w-8"></i>
                    <span class="hidden lg:block font-medium">Invoices</span>
                </button>
                 <!-- NEW Tab for Search -->
                <button onclick="nav('search')" id="btn-search" class="nav-button w-full flex items-center p-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-colors">
                    <i class="fa-solid fa-magnifying-glass text-lg w-8"></i>
                    <span class="hidden lg:block font-medium">Search</span>
                </button>
            </nav>

            <div class="p-4 border-t border-white/10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-gray-700 to-black border border-brand-lime flex items-center justify-center shadow-lg">
                        <i class="fa-solid fa-user-astronaut text-brand-lime text-lg"></i>
                    </div>
                    <div class="hidden lg:block">
                        <p class="text-sm font-bold text-white">Admin</p>
                        <p class="text-xs text-brand-lime font-semibold">Online</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col relative overflow-hidden">
            
            <!-- HEADER -->
            <header class="h-20 glass-panel border-l-0 border-t-0 border-r-0 flex items-center justify-between px-8 z-10">
                <h2 id="page-title" class="text-2xl font-bold tracking-tight text-white uppercase">Overview</h2>
                <div class="flex items-center gap-4">
                    <span class="text-xs font-semibold text-brand-lime border border-brand-lime/30 px-3 py-1.5 rounded-full bg-brand-lime/5">
                        <i class="fa-solid fa-location-dot mr-1"></i> Dhaka, BD
                    </span>
                    <button class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white transition">
                        <i class="fa-solid fa-bell"></i>
                    </button>
                    <button onclick="logout()" class="text-xs text-gray-500 hover:text-white uppercase tracking-widest font-bold ml-2">Logout</button>
                </div>
            </header>

            <!-- SCROLL AREA -->
            <div class="flex-1 overflow-y-auto p-4 lg:p-8 relative">
                
                <!-- 1. DASHBOARD VIEW -->
                <div id="view-dashboard" class="fade-in space-y-8">
                    <!-- Stats -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <div class="glass-panel p-6 rounded-xl relative overflow-hidden group">
                            <i class="fa-solid fa-sack-dollar text-4xl text-brand-lime/30 absolute right-4 top-4 group-hover:text-brand-lime transition-colors"></i>
                            <p class="text-gray-400 text-xs font-bold uppercase tracking-wider">Total Revenue</p>
                            <h3 class="text-3xl font-black mt-2 text-white" id="stat-revenue">৳ 0.00</h3>
                        </div>
                        <div class="glass-panel p-6 rounded-xl relative overflow-hidden group">
                            <i class="fa-solid fa-hourglass-start text-4xl text-blue-500/30 absolute right-4 top-4 group-hover:text-blue-500 transition-colors"></i>
                            <p class="text-gray-400 text-xs font-bold uppercase tracking-wider">Active Projects</p>
                            <h3 class="text-3xl font-black mt-2 text-white" id="stat-active-projects">0</h3>
                        </div>
                        <div class="glass-panel p-6 rounded-xl relative overflow-hidden group">
                            <i class="fa-solid fa-check-double text-4xl text-green-500/30 absolute right-4 top-4 group-hover:text-green-500 transition-colors"></i>
                            <p class="text-gray-400 text-xs font-bold uppercase tracking-wider">Completed Projects</p>
                            <h3 class="text-3xl font-black mt-2 text-white" id="stat-completed-projects">0</h3>
                        </div>
                        <div class="glass-panel p-6 rounded-xl relative overflow-hidden group">
                            <i class="fa-solid fa-hand-holding-dollar text-4xl text-red-500/30 absolute right-4 top-4 group-hover:text-red-500 transition-colors"></i>
                            <p class="text-gray-400 text-xs font-bold uppercase tracking-wider">Total Due</p>
                            <h3 class="text-3xl font-black mt-2 text-red-400" id="stat-due">৳ 0.00</h3>
                        </div>
                    </div>
                    
                    <!-- Chart & Activity -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 glass-panel p-6 rounded-xl">
                            <h3 class="text-xl font-bold mb-4">Project Status Infographic</h3>
                            <canvas id="project-chart" width="400" height="150"></canvas>
                        </div>

                        <div class="glass-panel p-6 rounded-xl">
                            <h3 class="text-xl font-bold mb-4">Recent Activity</h3>
                            <ul id="activity-list" class="space-y-3 text-sm">
                                <li class="text-gray-400"><i class="fa-solid fa-circle-check text-brand-lime mr-2"></i> Initialized Dashboard.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 2. PROJECTS VIEW -->
                <div id="view-projects" class="hidden fade-in space-y-6">
                    <h3 class="text-xl font-bold text-brand-lime uppercase tracking-wide">Projects Monitor</h3>
                    <div class="glass-panel rounded-xl overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-white/5 text-gray-400 text-xs uppercase tracking-wider font-bold">
                                <tr>
                                    <th class="p-4">Project Name</th>
                                    <th class="p-4">Client</th>
                                    <th class="p-4">Description</th>
                                    <th class="p-4">Status</th>
                                    <th class="p-4 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="projects-table-body" class="divide-y divide-white/10 text-sm font-medium">
                                <tr>
                                    <td colspan="5" class="p-8 text-center text-gray-500 italic">No active projects tracking. Add via the Client page.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 3. CLIENTS VIEW -->
                <div id="view-clients" class="hidden fade-in space-y-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-brand-lime uppercase tracking-wide">Client Database</h3>
                        <button onclick="toggleForm('client-form-section')" class="btn-lime px-5 py-2 rounded shadow-[0_0_15px_#E0FF00] text-sm font-bold uppercase">
                            <i class="fa-solid fa-plus mr-2"></i> Add Client
                        </button>
                    </div>

                     <!-- Add Client Form Step 1 -->
                     <div id="client-form-section" class="hidden glass-panel p-6 rounded-xl border-l-4 border-l-brand-lime">
                        <h4 class="text-lg font-bold mb-3 text-white">New Client Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <input type="text" id="new-client-name" placeholder="Name" class="input-dark px-4 py-3 rounded font-medium">
                            <input type="email" id="new-client-mail" placeholder="Mail" class="input-dark px-4 py-3 rounded font-medium">
                            <input type="text" id="new-client-phone" placeholder="Phone" class="input-dark px-4 py-3 rounded font-medium">
                            <input type="text" id="new-client-location" placeholder="Location" class="input-dark px-4 py-3 rounded font-medium">
                        </div>
                        <button onclick="addClientStep1()" class="text-xs bg-white text-black font-bold px-6 py-3 rounded hover:bg-gray-200 uppercase tracking-wide">Next: Add Project</button>
                    </div>
                    
                    <!-- Add Client Project Form Step 2 (Hidden initially) -->
                    <div id="project-entry-section" class="hidden glass-panel p-6 rounded-xl border-l-4 border-l-blue-500">
                        <h4 class="text-lg font-bold mb-3 text-blue-400">Project Details for <span id="current-client-name" class="font-black"></span></h4>
                        <div class="space-y-4">
                            <input type="text" id="new-proj-name" placeholder="Project Title" class="input-dark w-full px-4 py-3 rounded font-medium">
                            <textarea id="new-proj-desc" rows="3" placeholder="Project Description (a paragraph)" class="input-dark w-full px-4 py-3 rounded font-medium"></textarea>
                            <h5 class="text-sm font-bold text-gray-400 uppercase mt-4">Tasks/Deliverables Listing Area (One per line)</h5>
                            <textarea id="new-proj-tasks" rows="4" placeholder="Task 1&#10;Task 2&#10;Task 3" class="input-dark w-full px-4 py-3 rounded font-medium"></textarea>
                            <select id="new-proj-status" class="input-dark w-full px-4 py-3 rounded font-medium">
                                <option value="Active" class="text-black">Active (In Progress)</option>
                                <option value="Pending" class="text-black">Pending</option>
                                <option value="Completed" class="text-black">Completed</option>
                            </select>
                        </div>
                        <button onclick="addClientProjectStep2()" class="btn-lime text-sm font-bold px-6 py-3 rounded mt-4 uppercase tracking-wide">Save Client & Project</button>
                        <button onclick="cancelProjectEntry()" class="text-sm text-gray-500 font-bold px-6 py-3 rounded mt-4 ml-2 hover:text-red-500">Cancel</button>
                    </div>

                    <!-- Clients Table -->
                    <div class="glass-panel rounded-xl overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-white/5 text-gray-400 text-xs uppercase tracking-wider font-bold">
                                <tr>
                                    <th class="p-4">Name</th>
                                    <th class="p-4">Mail / Phone</th>
                                    <th class="p-4">Location</th>
                                    <th class="p-4 text-right">Projects Count</th>
                                </tr>
                            </thead>
                            <tbody id="clients-table-body" class="divide-y divide-white/10 text-sm font-medium">
                                <tr>
                                    <td colspan="4" class="p-8 text-center text-gray-500 italic">Database empty. Add client data above.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 4. INVOICE GENERATOR VIEW (Original, for creating) -->
                <div id="view-invoiceGen" class="hidden fade-in h-full">
                    <div class="flex flex-col xl:flex-row gap-6 h-full">
                        
                        <!-- Invoice Editor (Left) -->
                        <div class="w-full xl:w-5/12 space-y-4">
                            <div class="glass-panel p-6 rounded-xl">
                                <h3 class="text-brand-lime font-bold mb-4 uppercase tracking-widest text-xs">Invoice Configuration</h3>
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-gray-500 text-xs font-bold mb-1 uppercase">Invoice #</label>
                                        <input type="text" id="inv-num" value="ART-001" class="input-dark w-full px-3 py-2.5 rounded text-sm font-bold tracking-wide">
                                    </div>
                                    <div>
                                        <label class="block text-gray-500 text-xs font-bold mb-1 uppercase">Date</label>
                                        <input type="date" id="inv-date" class="input-dark w-full px-3 py-2.5 rounded text-sm font-medium">
                                    </div>
                                </div>
                                <div class="space-y-3 mb-6">
                                    <input type="text" id="inv-client-name" placeholder="Bill To: Client Name" class="input-dark w-full px-3 py-2.5 rounded text-sm font-medium">
                                    <textarea id="inv-client-addr" rows="2" placeholder="Client Address" class="input-dark w-full px-3 py-2.5 rounded text-sm font-medium"></textarea>
                                </div>
                                <div class="border-t border-white/10 pt-4">
                                    <div class="flex justify-between items-center mb-3">
                                        <span class="text-sm font-bold uppercase tracking-wide">Line Items</span>
                                        <button onclick="addInvoiceItem()" class="text-xs text-brand-lime hover:underline font-bold uppercase">+ Add Row</button>
                                    </div>
                                    <div id="invoice-rows" class="space-y-2 max-h-48 overflow-y-auto pr-2 custom-scroll">
                                        <!-- Rows injected here -->
                                    </div>
                                </div>
                            </div>
                            <button onclick="storeAndDownloadPDF()" class="btn-lime w-full py-4 rounded-xl font-black shadow-lg flex items-center justify-center gap-2 uppercase tracking-wide">
                                <i class="fa-solid fa-file-pdf"></i> Save & Generate PDF
                            </button>
                        </div>

                        <!-- Invoice Preview (Right) -->
                        <div class="w-full xl:w-7/12 bg-gray-900 rounded-xl overflow-auto p-4 flex justify-center items-start border border-white/10">
                            <div id="pdf-preview" class="invoice-paper w-[210mm] p-10 md:p-14 relative shadow-2xl text-black">
                                <div class="flex justify-between items-start mb-12 border-b-4 border-black pb-6">
                                    <div>
                                        <h1 class="text-4xl font-black tracking-tighter mb-1 text-black">ARTISTEEKA</h1>
                                        <p class="text-xs font-bold uppercase tracking-[0.2em] text-[#8db600]">Business Solutions</p>
                                    </div>
                                    <div class="text-right">
                                        <h2 class="text-5xl font-black text-gray-100 uppercase absolute right-14 top-10 z-0 tracking-tighter">Invoice</h2>
                                        <div class="relative z-10 bg-white pl-4">
                                            <p class="font-bold text-xl text-black" id="prev-num">#ART-001</p>
                                            <p class="text-sm text-gray-500 font-medium" id="prev-date">Oct 25, 2023</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-between mb-12 font-medium">
                                    <div class="text-sm leading-relaxed">
                                        <p class="font-bold text-gray-400 text-xs uppercase mb-2 tracking-wide">From</p>
                                        <p class="font-bold text-black text-base">Artisteeka</p>
                                        <p>Hazaribagh, Dhaka, Bangladesh</p>
                                        <p>+8801581512026</p>
                                        <p>contact@artisteeka.com</p>
                                        <p>www.artisteeka.com</p>
                                    </div>
                                    <div class="text-right text-sm leading-relaxed">
                                        <p class="font-bold text-gray-400 text-xs uppercase mb-2 tracking-wide">Bill To</p>
                                        <p class="font-bold text-xl text-black" id="prev-client">Client Name</p>
                                        <p class="whitespace-pre-line text-gray-600" id="prev-addr">Client Address</p>
                                    </div>
                                </div>
                                <table class="w-full mb-8">
                                    <thead>
                                        <tr class="bg-black text-white">
                                            <th class="py-3 px-4 text-left text-xs font-bold uppercase tracking-wider">Description</th>
                                            <th class="py-3 px-4 text-center text-xs font-bold uppercase tracking-wider w-16">Qty</th>
                                            <th class="py-3 px-4 text-right text-xs font-bold uppercase tracking-wider w-24">Price</th>
                                            <th class="py-3 px-4 text-right text-xs font-bold uppercase tracking-wider w-32">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="prev-items" class="text-sm font-medium text-gray-800">
                                        <!-- Items -->
                                    </tbody>
                                </table>
                                <div class="flex justify-end">
                                    <div class="w-1/2 space-y-2">
                                        <div class="flex justify-between py-3 border-b-2 border-black">
                                            <span class="font-bold text-black uppercase tracking-wide">Grand Total</span>
                                            <span class="font-black text-2xl text-black" id="prev-total">৳0.00</span>
                                        </div>
                                        <div class="mt-8 text-right">
                                            <div class="inline-block border-4 border-[#E0FF00] p-3 rotate-[-5deg] opacity-90">
                                                <p class="text-[#8db600] font-black text-sm uppercase tracking-widest">Authorized</p>
                                                <p class="text-xs font-bold uppercase text-black">Artisteeka Admin</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="absolute bottom-10 left-10 right-10 border-t border-gray-200 pt-4 text-center">
                                    <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Thank you for working with Artisteeka.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. INVOICES VIEW (For stored invoices) -->
                <div id="view-invoices" class="hidden fade-in space-y-6">
                    <h3 class="text-xl font-bold text-brand-lime uppercase tracking-wide">Stored Invoices</h3>
                    <div class="glass-panel rounded-xl overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-white/5 text-gray-400 text-xs uppercase tracking-wider font-bold">
                                <tr>
                                    <th class="p-4">Invoice #</th>
                                    <th class="p-4">Client</th>
                                    <th class="p-4">Date</th>
                                    <th class="p-4 text-right">Amount</th>
                                    <th class="p-4 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="invoices-table-body" class="divide-y divide-white/10 text-sm font-medium">
                                <tr>
                                    <td colspan="5" class="p-8 text-center text-gray-500 italic">No invoices have been saved yet.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 6. SEARCH VIEW -->
                <div id="view-search" class="hidden fade-in space-y-6">
                    <h3 class="text-xl font-bold text-brand-lime uppercase tracking-wide">Global Search</h3>
                    <div class="glass-panel p-6 rounded-xl">
                        <input type="text" id="search-input" oninput="performSearch()" placeholder="Search Invoice #, Client Name, Project Title, or Keyword..." class="input-dark w-full px-4 py-3 rounded font-medium text-lg">
                    </div>

                    <div id="search-results" class="space-y-4">
                        <div class="glass-panel p-6 rounded-xl text-center text-gray-500 italic">
                            Type a term to search across all data.
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // --- DATA STORE (Using localStorage for persistence) ---
        let clients = JSON.parse(localStorage.getItem('clients')) || [];
        let projects = JSON.parse(localStorage.getItem('projects')) || [];
        let invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        let invoiceItems = [{id: 1, desc: "Consultation Service", qty: 1, price: 5000}];
        let tempNewClient = null; // Used for the two-step client/project process

        const updateLocalStorage = () => {
            localStorage.setItem('clients', JSON.stringify(clients));
            localStorage.setItem('projects', JSON.stringify(projects));
            localStorage.setItem('invoices', JSON.stringify(invoices));
        };

        // --- AUTH SYSTEM ---
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('eye-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.classList.remove('fa-eye');
                eyeIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                eyeIcon.classList.remove('fa-eye-slash');
                eyeIcon.classList.add('fa-eye');
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const err = document.getElementById('login-error');

            // Simple hardcoded login for demo
            if (u === 'artisteeka_admin' && p === 'thedashboard') {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                initApp();
            } else {
                err.classList.remove('hidden');
                document.getElementById('password').value = '';
                const container = document.querySelector('#login-screen .glass-panel');
                container.classList.add('shake');
                setTimeout(() => container.classList.remove('shake'), 500);
            }
        }

        function logout() {
            location.reload();
        }

        // --- NAVIGATION ---
        function nav(view) {
            // Hide all views
            ['dashboard', 'projects', 'clients', 'invoiceGen', 'invoices', 'search'].forEach(id => {
                document.getElementById(`view-${id}`).classList.add('hidden');
                const btn = document.getElementById(`btn-${id}`);
                btn.className = "nav-button w-full flex items-center p-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-colors";
            });

            // Show current view and set button style
            document.getElementById(`view-${view}`).classList.remove('hidden');
            const activeBtn = document.getElementById(`btn-${view}`);
            activeBtn.className = "nav-button w-full flex items-center p-3 rounded-lg text-brand-lime bg-white/10 border border-brand-lime/20 shadow-[0_0_15px_rgba(224,255,0,0.1)]";

            // Update Title
            const titles = {
                'dashboard': 'Overview',
                'projects': 'Projects Monitor',
                'clients': 'Client Database',
                'invoiceGen': 'Invoice Generator',
                'invoices': 'Stored Invoices',
                'search': 'Global Search'
            };
            document.getElementById('page-title').innerText = titles[view];
            
            // Render data specific to the view
            if (view === 'dashboard') {
                renderChart();
            } else if (view === 'invoices') {
                renderInvoicesTable();
            } else if (view === 'search') {
                document.getElementById('search-input').value = '';
                document.getElementById('search-results').innerHTML = '<div class="glass-panel p-6 rounded-xl text-center text-gray-500 italic">Type a term to search across all data.</div>';
            }
        }
        
        function toggleForm(id) {
            document.getElementById(id).classList.toggle('hidden');
            // Ensure project form is hidden when opening client form
            document.getElementById('project-entry-section').classList.add('hidden');
        }

        // --- DASHBOARD LOGIC (Stats & Chart) ---
        function updateStats() {
            const active = projects.filter(p => p.status === 'Active').length;
            const completed = projects.filter(p => p.status === 'Completed').length;
            
            // Simple Revenue Calculation (Total projects * a mock average price)
            const totalRevenue = projects.reduce((sum, p) => sum + (p.price || 15000), 0);
            const totalDue = projects.filter(p => p.status === 'Active').reduce((sum, p) => sum + (p.price || 15000), 0) * 0.5; // Mock 50% due on active

            document.getElementById('stat-active-projects').innerText = active;
            document.getElementById('stat-completed-projects').innerText = completed;
            document.getElementById('stat-revenue').innerText = "৳ " + totalRevenue.toLocaleString('en-IN');
            document.getElementById('stat-due').innerText = "৳ " + totalDue.toLocaleString('en-IN');
            
            renderChart();
        }

        function renderChart() {
            const canvas = document.getElementById('project-chart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const data = {
                active: projects.filter(p => p.status === 'Active').length,
                pending: projects.filter(p => p.status === 'Pending').length,
                completed: projects.filter(p => p.status === 'Completed').length,
            };

            const total = data.active + data.pending + data.completed;
            const activeHeight = (data.active / total) * canvas.height * 0.8 || 10;
            const pendingHeight = (data.pending / total) * canvas.height * 0.8 || 10;
            const completedHeight = (data.completed / total) * canvas.height * 0.8 || 10;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const barWidth = 80;
            const xOffset = 50;
            const yBase = canvas.height - 20;

            // Bar 1: Active
            ctx.fillStyle = '#3b82f6';
            ctx.fillRect(xOffset, yBase - activeHeight, barWidth, activeHeight);
            ctx.fillStyle = '#fff';
            ctx.fillText('Active: ' + data.active, xOffset + barWidth / 2 - 20, yBase - activeHeight - 5);
            ctx.fillStyle = '#aaa';
            ctx.fillText('Active', xOffset + 20, yBase + 15);

            // Bar 2: Pending
            ctx.fillStyle = '#f59e0b';
            ctx.fillRect(xOffset + barWidth + 50, yBase - pendingHeight, barWidth, pendingHeight);
            ctx.fillStyle = '#fff';
            ctx.fillText('Pending: ' + data.pending, xOffset + barWidth + 50 + barWidth / 2 - 25, yBase - pendingHeight - 5);
            ctx.fillStyle = '#aaa';
            ctx.fillText('Pending', xOffset + barWidth + 70, yBase + 15);

            // Bar 3: Completed
            ctx.fillStyle = '#E0FF00';
            ctx.fillRect(xOffset + (barWidth + 50) * 2, yBase - completedHeight, barWidth, completedHeight);
            ctx.fillStyle = '#000';
            ctx.fillText('Completed: ' + data.completed, xOffset + (barWidth + 50) * 2 + barWidth / 2 - 35, yBase - completedHeight - 5);
            ctx.fillStyle = '#aaa';
            ctx.fillText('Completed', xOffset + (barWidth + 50) * 2 + 10, yBase + 15);
        }

        // --- CLIENTS & PROJECTS LOGIC (Two-Step Process) ---
        function addClientStep1() {
            const name = document.getElementById('new-client-name').value;
            const mail = document.getElementById('new-client-mail').value;
            const phone = document.getElementById('new-client-phone').value;
            const location = document.getElementById('new-client-location').value;

            if (name && mail && phone && location) {
                // Store client data temporarily
                tempNewClient = {
                    id: Date.now(),
                    name,
                    mail,
                    phone,
                    location,
                    projectIds: []
                };

                document.getElementById('current-client-name').innerText = name;
                document.getElementById('client-form-section').classList.add('hidden');
                document.getElementById('project-entry-section').classList.remove('hidden');
                
                // Reset project form fields
                document.getElementById('new-proj-name').value = '';
                document.getElementById('new-proj-desc').value = '';
                document.getElementById('new-proj-tasks').value = '';
                document.getElementById('new-proj-status').value = 'Active';
            } else {
                alert('Please fill in all client details.');
            }
        }

        function addClientProjectStep2() {
            if (!tempNewClient) return;

            const projName = document.getElementById('new-proj-name').value;
            const projDesc = document.getElementById('new-proj-desc').value;
            const projTasks = document.getElementById('new-proj-tasks').value.split('\n').filter(t => t.trim() !== '');
            const projStatus = document.getElementById('new-proj-status').value;

            if (projName && projDesc) {
                const projectId = Date.now() + 1;

                // 1. Save new project
                const newProject = {
                    id: projectId,
                    name: projName,
                    clientName: tempNewClient.name,
                    description: projDesc,
                    tasks: projTasks,
                    status: projStatus,
                    price: 15000 + Math.floor(Math.random() * 20000) // Mock price
                };
                projects.push(newProject);

                // 2. Link and save client
                tempNewClient.projectIds.push(projectId);
                clients.push(tempNewClient);

                // 3. Cleanup and update UI
                tempNewClient = null;
                document.getElementById('project-entry-section').classList.add('hidden');
                document.getElementById('client-form-section').classList.add('hidden');
                
                updateLocalStorage();
                renderClients();
                renderProjectsTable();
                updateStats();
                
                document.getElementById('activity-list').insertAdjacentHTML('afterbegin', `<li class="text-white"><i class="fa-solid fa-user-plus text-green-500 mr-2"></i> New Client ${tempNewClient.name} added with project ${newProject.name}.</li>`);

            } else {
                alert('Please fill in project title and description.');
            }
        }

        function cancelProjectEntry() {
            tempNewClient = null;
            document.getElementById('project-entry-section').classList.add('hidden');
            document.getElementById('client-form-section').classList.add('hidden');
        }

        function renderClients() {
            const tbody = document.getElementById('clients-table-body');
            if(clients.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="p-8 text-center text-gray-500 italic">Database empty. Add client data above.</td></tr>';
                return;
            }
            tbody.innerHTML = clients.map(c => `
                <tr class="hover:bg-white/5 transition">
                    <td class="p-4 font-bold text-white">${c.name}</td>
                    <td class="p-4 text-gray-300 font-medium">Email: ${c.mail}<br>Phone: ${c.phone}</td>
                    <td class="p-4 text-gray-400 font-medium">${c.location}</td>
                    <td class="p-4 text-right font-black text-brand-lime">${c.projectIds.length}</td>
                </tr>
            `).join('');
        }

        function renderProjectsTable() {
            const tbody = document.getElementById('projects-table-body');
            if(projects.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-gray-500 italic">No active projects tracking. Add via the Client page.</td></tr>';
                return;
            }
            tbody.innerHTML = projects.map((p, i) => `
                <tr class="hover:bg-white/5 transition">
                    <td class="p-4 font-bold text-white">${p.name}</td>
                    <td class="p-4 text-gray-300 font-medium">${p.clientName}</td>
                    <td class="p-4 text-gray-400 text-xs">${p.description.substring(0, 50)}...</td>
                    <td class="p-4"><span class="px-2 py-1 rounded text-xs font-bold uppercase tracking-wide ${getStatusColor(p.status)}">${p.status}</span></td>
                    <td class="p-4 text-right"><button onclick="deleteProject(${i})" class="text-red-400 hover:text-red-500"><i class="fa-solid fa-trash"></i></button></td>
                </tr>
            `).join('');
        }
        
        function deleteProject(index) {
            const projectIdToDelete = projects[index].id;
            // Remove project
            projects.splice(index, 1);

            // Remove project link from client
            clients.forEach(c => {
                const projectIndex = c.projectIds.indexOf(projectIdToDelete);
                if (projectIndex > -1) {
                    c.projectIds.splice(projectIndex, 1);
                }
            });

            updateLocalStorage();
            renderProjectsTable();
            renderClients();
            updateStats();
        }

        function getStatusColor(status) {
            if(status === 'Active') return 'bg-blue-500/20 text-blue-400 border border-blue-500/50';
            if(status === 'Completed') return 'bg-brand-lime/20 text-brand-lime border border-brand-lime/50';
            return 'bg-gray-700/20 text-gray-300';
        }

        // --- INVOICE GENERATOR LOGIC ---
        function addInvoiceItem() {
            invoiceItems.push({id: Date.now(), desc: "", qty: 1, price: 0});
            renderInvoiceInputs();
            updatePreview();
        }

        function updateInvItem(idx, field, val) {
            invoiceItems[idx][field] = field === 'desc' ? val : parseFloat(val);
            updatePreview();
        }

        function removeInvItem(idx) {
            if(invoiceItems.length > 1) {
                invoiceItems.splice(idx, 1);
                renderInvoiceInputs();
                updatePreview();
            }
        }

        function renderInvoiceInputs() {
            const container = document.getElementById('invoice-rows');
            container.innerHTML = invoiceItems.map((item, idx) => `
                <div class="grid grid-cols-12 gap-2 mb-2 bg-white/5 p-2 rounded">
                    <div class="col-span-6">
                        <input type="text" placeholder="Description" value="${item.desc}" oninput="updateInvItem(${idx}, 'desc', this.value)" class="w-full bg-transparent text-white text-xs font-medium focus:outline-none border-b border-gray-700">
                    </div>
                    <div class="col-span-2">
                        <input type="number" value="${item.qty}" oninput="updateInvItem(${idx}, 'qty', this.value)" class="w-full bg-transparent text-white text-xs text-center font-medium focus:outline-none border-b border-gray-700">
                    </div>
                    <div class="col-span-3">
                        <input type="number" value="${item.price}" oninput="updateInvItem(${idx}, 'price', this.value)" class="w-full bg-transparent text-white text-xs text-right font-medium focus:outline-none border-b border-gray-700">
                    </div>
                    <div class="col-span-1 text-center">
                        <button onclick="removeInvItem(${idx})" class="text-red-500 text-xs hover:text-red-400 font-bold">x</button>
                    </div>
                </div>
            `).join('');
        }

        function updatePreview() {
            // Header
            document.getElementById('prev-num').innerText = '#' + (document.getElementById('inv-num').value || 'DRAFT');
            const d = document.getElementById('inv-date').value;
            document.getElementById('prev-date').innerText = d ? new Date(d).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : 'TBD';
            
            // Client
            document.getElementById('prev-client').innerText = document.getElementById('inv-client-name').value || 'Client Name';
            document.getElementById('prev-addr').innerText = document.getElementById('inv-client-addr').value || 'Client Address';

            // Items
            const tbody = document.getElementById('prev-items');
            let total = 0;
            tbody.innerHTML = invoiceItems.map(item => {
                const lineTotal = (item.qty || 0) * (item.price || 0);
                total += lineTotal;
                return `
                    <tr class="border-b border-gray-100 last:border-0">
                        <td class="py-3 px-4 text-left">${item.desc}</td>
                        <td class="py-3 px-4 text-center">${item.qty}</td>
                        <td class="py-3 px-4 text-right">৳${(item.price || 0).toLocaleString('en-IN')}</td>
                        <td class="py-3 px-4 text-right font-bold">৳${lineTotal.toLocaleString('en-IN')}</td>
                    </tr>
                `;
            }).join('');

            document.getElementById('prev-total').innerText = '৳ ' + total.toLocaleString('en-IN');
            return total;
        }

        // Listeners for Invoice Header inputs
        ['inv-num', 'inv-date', 'inv-client-name', 'inv-client-addr'].forEach(id => {
            document.getElementById(id).addEventListener('input', updatePreview);
        });

        function storeAndDownloadPDF() {
            const invoiceNum = document.getElementById('inv-num').value;
            const clientName = document.getElementById('inv-client-name').value;
            const totalAmount = updatePreview(); // Recalculate total and update preview one last time

            if (!invoiceNum || !clientName || totalAmount === 0) {
                alert('Please ensure Invoice #, Client Name, and at least one item are filled out.');
                return;
            }

            // Store Invoice
            const newInvoice = {
                id: Date.now(),
                number: invoiceNum,
                client: clientName,
                date: document.getElementById('inv-date').value,
                amount: totalAmount,
                items: JSON.parse(JSON.stringify(invoiceItems)), // Deep copy items
            };
            invoices.unshift(newInvoice); // Add to beginning
            updateLocalStorage();
            renderInvoicesTable();
            
            // Download PDF
            downloadPDF(invoiceNum);
        }

        function downloadPDF(id) {
            const element = document.getElementById('pdf-preview');
            
            const opt = {
                margin: 0,
                filename: `Artisteeka_Invoice_${id}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save();
        }

        // --- STORED INVOICES LOGIC ---
        function renderInvoicesTable() {
             const tbody = document.getElementById('invoices-table-body');
            if(invoices.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-gray-500 italic">No invoices have been saved yet.</td></tr>';
                return;
            }
            tbody.innerHTML = invoices.map(inv => `
                <tr class="hover:bg-white/5 transition">
                    <td class="p-4 font-bold text-brand-lime">#${inv.number}</td>
                    <td class="p-4 text-gray-300 font-medium">${inv.client}</td>
                    <td class="p-4 text-gray-400">${new Date(inv.date).toLocaleDateString()}</td>
                    <td class="p-4 text-right font-black text-white">৳${inv.amount.toLocaleString('en-IN')}</td>
                    <td class="p-4 text-right">
                        <button onclick="deleteInvoice(${inv.id})" class="text-red-400 hover:text-red-500"><i class="fa-solid fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteInvoice(id) {
            invoices = invoices.filter(inv => inv.id !== id);
            updateLocalStorage();
            renderInvoicesTable();
        }

        // --- SEARCH LOGIC ---
        function performSearch() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = '';
            
            if (query.length < 2) {
                resultsDiv.innerHTML = '<div class="glass-panel p-6 rounded-xl text-center text-gray-500 italic">Type a term to search across all data.</div>';
                return;
            }

            let html = '';
            
            // Search Clients
            const foundClients = clients.filter(c => 
                c.name.toLowerCase().includes(query) || 
                c.mail.toLowerCase().includes(query) ||
                c.phone.toLowerCase().includes(query)
            );
            if (foundClients.length > 0) {
                html += `<div class="glass-panel p-4 rounded-xl border-l-4 border-l-brand-lime">
                            <h4 class="font-bold text-lg mb-2 text-brand-lime">Clients (${foundClients.length})</h4>
                            <ul class="space-y-1 text-sm">${foundClients.map(c => `
                                <li class="text-white">
                                    <i class="fa-solid fa-user text-gray-400 w-5"></i>
                                    <span class="font-semibold">${c.name}</span> - ${c.mail}
                                </li>`).join('')}
                            </ul>
                        </div>`;
            }

            // Search Projects
            const foundProjects = projects.filter(p => 
                p.name.toLowerCase().includes(query) || 
                p.clientName.toLowerCase().includes(query) ||
                p.description.toLowerCase().includes(query)
            );
             if (foundProjects.length > 0) {
                html += `<div class="glass-panel p-4 rounded-xl border-l-4 border-l-blue-500">
                            <h4 class="font-bold text-lg mb-2 text-blue-400">Projects (${foundProjects.length})</h4>
                            <ul class="space-y-1 text-sm">${foundProjects.map(p => `
                                <li class="text-white">
                                    <i class="fa-solid fa-bars-progress text-gray-400 w-5"></i>
                                    <span class="font-semibold">${p.name}</span> for ${p.clientName} (${p.status})
                                </li>`).join('')}
                            </ul>
                        </div>`;
            }

            // Search Invoices
            const foundInvoices = invoices.filter(i => 
                i.number.toLowerCase().includes(query) || 
                i.client.toLowerCase().includes(query) ||
                i.items.some(item => item.desc.toLowerCase().includes(query))
            );
            if (foundInvoices.length > 0) {
                html += `<div class="glass-panel p-4 rounded-xl border-l-4 border-l-purple-500">
                            <h4 class="font-bold text-lg mb-2 text-purple-400">Invoices (${foundInvoices.length})</h4>
                            <ul class="space-y-1 text-sm">${foundInvoices.map(i => `
                                <li class="text-white">
                                    <i class="fa-solid fa-file-invoice-dollar text-gray-400 w-5"></i>
                                    <span class="font-semibold">#${i.number}</span> to ${i.client} - ৳${i.amount.toLocaleString('en-IN')}
                                </li>`).join('')}
                            </ul>
                        </div>`;
            }

            if (html === '') {
                resultsDiv.innerHTML = '<div class="glass-panel p-6 rounded-xl text-center text-red-400 italic font-bold">No results found for "' + query + '".</div>';
            } else {
                resultsDiv.innerHTML = html;
            }
        }


        // --- INITIALIZATION ---
        function initApp() {
            // Set initial invoice date
            document.getElementById('inv-date').valueAsDate = new Date();
            
            renderInvoiceInputs();
            updatePreview();
            renderClients();
            renderProjectsTable();
            updateStats();
            
            // Start on dashboard view
            nav('dashboard'); 
        }
    </script>
</body>
</html>
